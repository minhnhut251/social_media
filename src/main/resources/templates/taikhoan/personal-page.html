<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="https://www.thymeleaf.org/thymeleaf-extras-springsecurity6">
<head>
    <meta charset="UTF-8">
    <title>User Posts</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css">
    <script type="text/javascript" src="/webjars/jquery/jquery.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
    <style>
        .cover-photo {
            width: 100%;
            height: 300px;
            position: relative;
            object-fit: cover;
        }
        .avatar-wrapper {
            position: relative;
        }

        .avatar {
            width: 170px;
            height: 170px;
            border-radius: 50%;
            position: absolute;
            bottom: -50px;
            left: 20px;
            border: 5px solid white;
            object-fit: cover;
            transition: opacity 0.3s ease;
        }

        .edit-overlay {
            position: absolute;
            bottom: -50px;
            left: 20px;
            width: 170px;
            height: 170px;
            border-radius: 50%;
            background-color: rgba(0, 0, 0, 0.4);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none; /* để không chặn click */
        }

        .avatar-wrapper a:hover .edit-overlay {
            opacity: 1;
            pointer-events: auto;
        }

        .profile-buttons button {
            margin-left: 10px;
        }

        .mt-profile {
            margin-top: 100px;
        }
    </style>

</head>
<body>
<div th:replace="~{fragments/navbar :: navbar}"></div>

<div class="container" style="margin-top:100px;">
    <div class="container mt-profile">
        <div class="cover-photo position-relative">
            <img th:if="${profileUser.banner != null}" th:src="@{${profileUser.banner}}" class="w-100 h-100 object-fit-cover" alt="User Banner">
            <img th:unless="${profileUser.banner != null}" src="/img/placeholder.jpg" class="w-100 h-100 object-fit-cover" alt="Default Banner">
            <a th:if="${isOwnProfile}" th:href="@{/profile/edit_banner}" class="btn btn-sm position-absolute end-0 m-3 btn-primary">
                <i class="fa fa-camera"></i> Thêm ảnh bìa
            </a>
            <div class="avatar-wrapper position-relative">
                <a th:if="${isOwnProfile}" th:href="@{/profile/edit_avatar}">
                    <img th:if="${profileUser.avatar != null}" th:src="@{${profileUser.avatar}}" class="avatar" alt="Avatar">
                    <img th:unless="${profileUser.avatar != null}" src="/img/placeholder.jpg" class="avatar" alt="Avatar">
                    <span class="edit-overlay"><i class="fas fa-camera"></i></span>
                </a>
                <img th:if="${!isOwnProfile}" th:src="@{${profileUser.avatar}}" class="avatar" alt="Avatar">
            </div>
        </div>

        <div class="mt-5 d-flex align-items-center justify-content-between">
            <div>
                <h2 th:text="${profileUser.lastName + ' ' + profileUser.firstName}">Tên người dùng</h2>
<!--                <p th:text="${listFriendsCount + ' người bạn'}">Số bạn bè</p>-->
            </div>
<!--            <div class="profile-buttons">-->
<!--                <a th:if="${isOwnProfile}" th:href="@{/profile/edit}" class="btn btn-secondary"><i class="fa fa-edit"></i> Chỉnh sửa trang cá nhân</a>-->
<!--            </div>-->

            <div >
<!--                <form  method="post" class="d-inline">-->
<!--                    <input type="hidden" name="userId"  />-->
<!--                    <button type="submit" class="btn btn-primary"><i class="fas fa-user-plus"></i> Thêm bạn</button>-->
<!--                </form>-->
                <a th:if="${!isOwnProfile}" th:href="@{/messenger/{id} (id=${profileUser.id})}" class="btn btn-primary">
                    <i class="fas fa-comment-dots"></i> Nhắn tin
                </a>
                <a th:href="@{/friends/list}" class="btn btn-outline-secondary ms-2">Bạn bè</a>
            </div>
        </div>
    </div>


    <div class="row mt-4">
        <div class="col-md-4">
            <div class="card p-3 shadow-sm">
                <h5 class="fw-bold">Thông tin cá nhân</h5>
                <p><strong>Mô tả:</strong> <span th:text="${profileUser.moTa}"></span></p>
                <p><strong>Ngày sinh:</strong> <span th:text="${profileUser.ngaysinh}"></span></p>
                <p><strong>Giới tính:</strong> <span th:text="${profileUser.sex}"></span></p>
                <p><strong>Nơi làm việc:</strong> <span th:text="${profileUser.noiLamViec}"></span></p>
                <p><strong>Địa chỉ:</strong> <span th:text="${profileUser.diaChi}"></span></p>
                <p><strong>Học vấn:</strong> <span th:text="${profileUser.hocVan}"></span></p>
                <p><strong>Số điện thoại:</strong> <span th:text="${profileUser.sdt}"></span></p>
                <a th:if="${isOwnProfile}" th:href="@{/profile/edit}" class="btn btn-primary w-100 mt-2">
                    <i class="fas fa-edit"></i> Sửa thông tin
                </a>
            </div>
        </div>
        <div class="col-md-8">


            <!-- Danh sách bài viết -->
            <h3 class="mb-4 mt-4">Posts</h3>

            <!-- Nếu không có bài viết -->
            <div th:if="${listPosts.isEmpty()}" class="alert alert-info">
                This user hasn't posted anything yet.
            </div>

            <!-- Danh sách bài viết động -->
            <div th:each="post: ${listPosts}" class="mb-4">
                <div th:replace="~{fragments/postCard :: postCard(${post})}"></div>
            </div>
        </div>


    </div>
</div>

<script src="/js/like.js"></script>
<script src="/js/themgio.js"></script>
</body>
</html>